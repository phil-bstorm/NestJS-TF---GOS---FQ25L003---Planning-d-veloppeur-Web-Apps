# Documentation

La documentation de l'API est générée automatiquement à l'aide de Swagger et OpenAPI. Voici comment procéder :

## Installation des dépendances swagger

Assurez-vous d'avoir installé les paquets nécessaires pour Swagger et OpenAPI dans votre projet NestJS :

```bash
npm install --save @nestjs/swagger
```

## Configuration de Swagger

Dans votre fichier principal (généralement `main.ts`), configurez Swagger comme suit :

```typescript
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { ValidationPipe } from '@nestjs/common';
import { DocumentBuilder, SwaggerModule } from '@nestjs/swagger';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);

  // Validation de DTOs
  app.useGlobalPipes(new ValidationPipe());

  // Swagger configuration
  const config = new DocumentBuilder()
    .setTitle('Todo example')
    .setDescription('The todos API description')
    .setVersion('1.0')
    .build();
  const documentFactory = () => SwaggerModule.createDocument(app, config);
  SwaggerModule.setup('api', app, documentFactory);

  await app.listen(process.env.PORT ?? 3000);
}
bootstrap();
```

## Accès à la documentation

Une fois que votre application est en cours d'exécution, vous pouvez accéder à la documentation Swagger en ouvrant votre navigateur et en naviguant vers :

```
http://localhost:3000/api
```

## Documentation des DTOs

Vous pouvez personnaliser la documentation en ajoutant des décorateurs Swagger à vos contrôleurs et DTOs. Par exemple :

```typescript
import { IsString, IsOptional, IsBoolean } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

export class TodoFormDto {
  @ApiProperty({
    description: 'The title of the todo item',
    example: 'Buy groceries',
    required: true,
  })
  @IsString()
  title: string;

  @ApiProperty({
    description: 'A detailed description of the todo item',
    example: 'Milk, Bread, Eggs, and Cheese',
    required: false,
  })
  @IsOptional()
  @IsString()
  description?: string;

  @ApiProperty({
    description: 'Indicates whether the todo item is completed',
    example: false,
    required: false,
  })
  @IsOptional()
  @IsBoolean()
  completed?: boolean;
}

export class TodoUpdateDto {
  @ApiProperty({
    description: 'The title of the todo item',
    example: 'Buy groceries',
    required: true,
  })
  @IsOptional()
  @IsString()
  title?: string;

  @ApiProperty({
    description: 'A detailed description of the todo item',
    example: 'Milk, Bread, Eggs, and Cheese',
    required: false,
  })
  @IsOptional()
  @IsString()
  description?: string;
}

export class TodoCompletionDto {
  @ApiProperty({
    description: 'Indicates whether the todo item is completed',
    example: true,
    required: true,
  })
  @IsBoolean()
  completed: boolean;
}
```

## Documentation des contrôleurs

Vous pouvez également documenter vos contrôleurs en utilisant les décorateurs Swagger. Par exemple :

```typescript
import {
  Body,
  Controller,
  Delete,
  Get,
  Param,
  ParseIntPipe,
  Patch,
  Post,
  Put,
} from '@nestjs/common';
import { ApiTags, ApiOperation, ApiParam, ApiBody, ApiResponse } from '@nestjs/swagger';
import { TodoService } from '../services/todo.service';
import { TodoCompletionDto, TodoFormDto, TodoUpdateDto } from '../dtos/todo.form.dto';
import { TodoDto } from '../dtos/todo.dto';
import {
  todoCompletionDtoToEntity,
  todoEntityToDto,
  todoFormDtoToEntity,
  todoUpdateDtoToEntity,
} from '../mappers/todo.mappers';

@ApiTags('todo')
@Controller('todo')
export class TodoController {
  constructor(private readonly todoService: TodoService) {}

  @Get()
  @ApiOperation({ summary: 'Récupérer toutes les todos' })
  @ApiResponse({ status: 200, description: 'Liste de toutes les todos', type: [TodoDto] })
  async getTodos(): Promise<TodoDto[]> {
    const todos = await this.todoService.getTodos();
    return todos.map(todoEntityToDto);
  }

  @Post()
  @ApiOperation({ summary: 'Créer une nouvelle todo' })
  @ApiBody({ type: TodoFormDto, description: 'Payload pour créer une todo' })
  @ApiResponse({ status: 201, description: 'Todo créée avec succès', type: TodoDto })
  @ApiResponse({ status: 400, description: 'Requête invalide' })
  async createTodo(@Body() body: TodoFormDto): Promise<TodoDto> {
    const todoEntity = todoFormDtoToEntity(body);
    const created = await this.todoService.createTodo(todoEntity);
    return todoEntityToDto(created);
  }

  @Get(':id')
  @ApiOperation({ summary: 'Récupérer une todo par ID' })
  @ApiParam({ name: 'id', type: Number, description: 'ID de la todo' })
  @ApiResponse({ status: 200, description: 'Todo trouvée', type: TodoDto })
  @ApiResponse({ status: 404, description: 'Todo non trouvée' })
  async getTodoById(@Param('id', ParseIntPipe) id: number): Promise<TodoDto> {
    const todo = await this.todoService.getTodoById(id);
    return todoEntityToDto(todo);
  }

  @Put(':id')
  @ApiOperation({ summary: 'Mettre à jour une todo (remplacement complet)' })
  @ApiParam({ name: 'id', type: Number, description: 'ID de la todo' })
  @ApiBody({ type: TodoUpdateDto, description: 'Payload pour mettre à jour une todo' })
  @ApiResponse({ status: 200, description: 'Todo mise à jour', type: TodoDto })
  @ApiResponse({ status: 400, description: 'Requête invalide' })
  @ApiResponse({ status: 404, description: 'Todo non trouvée' })
  async updateTodo(
    @Param('id', ParseIntPipe) id: number,
    @Body() body: TodoUpdateDto,
  ): Promise<TodoDto> {
    const todo = await this.todoService.getTodoById(id);
    const updatedEntity = todoUpdateDtoToEntity(body, todo);
    const updated = await this.todoService.updateTodo(id, updatedEntity);
    return todoEntityToDto(updated);
  }

  @Patch(':id/complete')
  @ApiOperation({ summary: 'Basculer le statut de complétion d’une todo' })
  @ApiParam({ name: 'id', type: Number, description: 'ID de la todo' })
  @ApiBody({ type: TodoCompletionDto, description: 'Payload pour changer le statut de complétion' })
  @ApiResponse({ status: 200, description: 'Le statut de la todo a été basculé', type: TodoDto })
  @ApiResponse({ status: 400, description: 'Requête invalide' })
  @ApiResponse({ status: 404, description: 'Todo non trouvée' })
  async toggleTodoCompletion(
    @Param('id', ParseIntPipe) id: number,
    @Body() body: TodoCompletionDto,
  ): Promise<TodoDto> {
    const todo = await this.todoService.getTodoById(id);
    const patchedEntity = todoCompletionDtoToEntity(body, todo);
    const updated = await this.todoService.updateTodo(id, patchedEntity);
    return todoEntityToDto(updated);
  }

  @Delete(':id')
  @ApiOperation({ summary: 'Supprimer une todo' })
  @ApiParam({ name: 'id', type: Number, description: 'ID de la todo' })
  @ApiResponse({ status: 200, description: 'Todo supprimée', type: TodoDto })
  @ApiResponse({ status: 404, description: 'Todo non trouvée' })
  async deleteTodo(@Param('id', ParseIntPipe) id: number): Promise<TodoDto> {
    const deleted = await this.todoService.deleteTodo(id);
    return todoEntityToDto(deleted);
  }
}
```
